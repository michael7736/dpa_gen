<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAGå‰åç«¯é›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§  AAGå‰åç«¯é›†æˆæµ‹è¯•</h1>
        <p>æµ‹è¯•AAGæ™ºèƒ½åˆ†æç³»ç»Ÿçš„å‰ç«¯å’Œåç«¯APIé›†æˆåŠŸèƒ½</p>
    </div>

    <div class="test-section">
        <h2>ğŸ”— æœåŠ¡è¿æ¥æµ‹è¯•</h2>
        <div id="service-status">
            <p>å‰ç«¯æœåŠ¡ (8230): <span id="frontend-status" class="status loading">æ£€æµ‹ä¸­...</span></p>
            <p>åç«¯API (8200): <span id="backend-status" class="status loading">æ£€æµ‹ä¸­...</span></p>
        </div>
        <button onclick="checkServices()">é‡æ–°æ£€æµ‹æœåŠ¡</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“„ æ–‡æ¡£åˆ†ææµ‹è¯•</h2>
        <textarea id="test-document" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;" 
                  placeholder="è¾“å…¥è¦åˆ†æçš„æ–‡æ¡£å†…å®¹...">äººå·¥æ™ºèƒ½åœ¨ç°ä»£åŒ»ç–—è¯Šæ–­ä¸­å‘æŒ¥ç€è¶Šæ¥è¶Šé‡è¦çš„ä½œç”¨ã€‚æœºå™¨å­¦ä¹ ç®—æ³•èƒ½å¤Ÿå¿«é€Ÿå¤„ç†å¤§é‡åŒ»å­¦å½±åƒæ•°æ®ï¼Œå¸®åŠ©åŒ»ç”Ÿæ›´å‡†ç¡®åœ°è¯Šæ–­ç–¾ç—…ã€‚æ·±åº¦å­¦ä¹ æ¨¡å‹åœ¨ç—…ç†å›¾åƒè¯†åˆ«ã€ç™Œç—‡ç­›æŸ¥å’Œä¸ªæ€§åŒ–æ²»ç–—æ–¹æ¡ˆåˆ¶å®šç­‰æ–¹é¢éƒ½å±•ç°å‡ºäº†å·¨å¤§çš„æ½œåŠ›ã€‚ç„¶è€Œï¼ŒAIæŠ€æœ¯åœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨ä¹Ÿé¢ä¸´ç€æ•°æ®éšç§ã€ç®—æ³•å¯è§£é‡Šæ€§å’ŒåŒ»ç–—è´£ä»»ç­‰æŒ‘æˆ˜ã€‚</textarea>
        <br><br>
        <button onclick="testSkimAnalysis()">ğŸ” å¿«é€Ÿç•¥è¯»</button>
        <button onclick="testSummaryGeneration()">ğŸ“ ç”Ÿæˆæ‘˜è¦</button>
        <button onclick="testKnowledgeGraph()">ğŸ•¸ï¸ çŸ¥è¯†å›¾è°±</button>
        <button onclick="testOutlineExtraction()">ğŸ“‹ å¤§çº²æå–</button>
        <button onclick="testDeepAnalysis()">ğŸ”¬ æ·±åº¦åˆ†æ</button>
        <button onclick="testCompleteWorkflow()">âš¡ å®Œæ•´å·¥ä½œæµ</button>
        
        <div id="analysis-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æ€§èƒ½æŒ‡æ ‡</h2>
        <div class="metrics">
            <div class="metric">
                <div class="metric-value" id="total-requests">0</div>
                <div>æ€»è¯·æ±‚æ•°</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="successful-requests">0</div>
                <div>æˆåŠŸè¯·æ±‚</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="avg-response-time">0ms</div>
                <div>å¹³å‡å“åº”æ—¶é—´</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="error-rate">0%</div>
                <div>é”™è¯¯ç‡</div>
            </div>
        </div>
        <button onclick="runPerformanceTest()">ğŸš€ æ€§èƒ½æµ‹è¯•</button>
        <button onclick="resetMetrics()">ğŸ”„ é‡ç½®æŒ‡æ ‡</button>
    </div>

    <div class="test-section">
        <h2>ğŸ›¡ï¸ é”™è¯¯å¤„ç†æµ‹è¯•</h2>
        <button onclick="testErrorHandling()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
        <button onclick="testInvalidRequests()">æµ‹è¯•æ— æ•ˆè¯·æ±‚</button>
        <div id="error-test-results"></div>
    </div>

    <script>
        let metrics = {
            totalRequests: 0,
            successfulRequests: 0,
            responseTimes: [],
            errors: 0
        };

        const API_BASE_URL = 'http://localhost:8200';
        const FRONTEND_URL = 'http://localhost:8230';

        // æœåŠ¡è¿æ¥æ£€æµ‹
        async function checkServices() {
            // æ£€æµ‹å‰ç«¯æœåŠ¡
            try {
                const frontendResponse = await fetch(FRONTEND_URL);
                document.getElementById('frontend-status').textContent = 'âœ… æ­£å¸¸è¿è¡Œ';
                document.getElementById('frontend-status').className = 'status success';
            } catch (error) {
                document.getElementById('frontend-status').textContent = 'âŒ è¿æ¥å¤±è´¥';
                document.getElementById('frontend-status').className = 'status error';
            }

            // æ£€æµ‹åç«¯API
            try {
                const backendResponse = await fetch(`${API_BASE_URL}/health`);
                const result = await backendResponse.json();
                document.getElementById('backend-status').textContent = `âœ… ${result.service} v${result.version}`;
                document.getElementById('backend-status').className = 'status success';
            } catch (error) {
                document.getElementById('backend-status').textContent = 'âŒ è¿æ¥å¤±è´¥';
                document.getElementById('backend-status').className = 'status error';
            }
        }

        // APIè¯·æ±‚å·¥å…·å‡½æ•°
        async function makeAPIRequest(endpoint, data = null, method = 'GET') {
            const startTime = Date.now();
            metrics.totalRequests++;

            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-USER-ID': 'test_user'
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                metrics.responseTimes.push(responseTime);

                if (response.ok) {
                    metrics.successfulRequests++;
                    const result = await response.json();
                    updateMetrics();
                    return { success: true, data: result, responseTime };
                } else {
                    metrics.errors++;
                    updateMetrics();
                    return { success: false, error: `HTTP ${response.status}`, responseTime };
                }
            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                metrics.errors++;
                metrics.responseTimes.push(responseTime);
                updateMetrics();
                return { success: false, error: error.message, responseTime };
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResult(title, result, responseTime) {
            const resultsDiv = document.getElementById('analysis-results');
            const resultElement = document.createElement('div');
            resultElement.className = 'result';
            
            const statusClass = result.success ? 'success' : 'error';
            const statusText = result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
            
            resultElement.innerHTML = `
                <h4>${title} <span class="status ${statusClass}">${statusText}</span> <small>(${responseTime}ms)</small></h4>
                <pre>${JSON.stringify(result.data || result.error, null, 2)}</pre>
            `;
            
            resultsDiv.insertBefore(resultElement, resultsDiv.firstChild);
        }

        // åˆ†æåŠŸèƒ½æµ‹è¯•
        async function testSkimAnalysis() {
            const content = document.getElementById('test-document').value;
            const request = {
                document_id: `test_${Date.now()}`,
                document_content: content,
                analysis_type: 'standard'
            };

            const result = await makeAPIRequest('/api/v1/aag/skim', request, 'POST');
            displayResult('å¿«é€Ÿç•¥è¯»åˆ†æ', result, result.responseTime);
        }

        async function testSummaryGeneration() {
            const content = document.getElementById('test-document').value;
            const request = {
                document_id: `test_${Date.now()}`,
                document_content: content,
                options: { summary_level: 'level_2' }
            };

            const result = await makeAPIRequest('/api/v1/aag/summary', request, 'POST');
            displayResult('æ‘˜è¦ç”Ÿæˆ', result, result.responseTime);
        }

        async function testKnowledgeGraph() {
            const content = document.getElementById('test-document').value;
            const request = {
                document_id: `test_${Date.now()}`,
                document_content: content,
                options: { extraction_mode: 'comprehensive' }
            };

            const result = await makeAPIRequest('/api/v1/aag/knowledge-graph', request, 'POST');
            displayResult('çŸ¥è¯†å›¾è°±æ„å»º', result, result.responseTime);
        }

        async function testOutlineExtraction() {
            const content = document.getElementById('test-document').value;
            const request = {
                document_id: `test_${Date.now()}`,
                document_content: content,
                options: { dimension: 'multi' }
            };

            const result = await makeAPIRequest('/api/v1/aag/outline', request, 'POST');
            displayResult('å¤§çº²æå–', result, result.responseTime);
        }

        async function testDeepAnalysis() {
            const content = document.getElementById('test-document').value;
            const request = {
                document_id: `test_${Date.now()}`,
                document_content: content,
                options: { analysis_types: ['evidence_chain', 'critical_thinking', 'cross_reference'] }
            };

            const result = await makeAPIRequest('/api/v1/aag/deep-analysis', request, 'POST');
            displayResult('æ·±åº¦åˆ†æ', result, result.responseTime);
        }

        async function testCompleteWorkflow() {
            const content = document.getElementById('test-document').value;
            const documentId = `workflow_test_${Date.now()}`;
            
            const request = {
                workflow_id: 'standard_analysis',
                document_id: documentId,
                initial_state: {
                    document_content: content
                }
            };

            const result = await makeAPIRequest('/api/v1/aag/workflow/standard_analysis/execute', request, 'POST');
            displayResult('å®Œæ•´å·¥ä½œæµæ‰§è¡Œ', result, result.responseTime);
        }

        // æ€§èƒ½æµ‹è¯•
        async function runPerformanceTest() {
            const testDocument = {
                document_id: `perf_test_${Date.now()}`,
                document_content: document.getElementById('test-document').value
            };

            // å¹¶å‘æµ‹è¯•
            const concurrentTests = [];
            for (let i = 0; i < 5; i++) {
                concurrentTests.push(
                    makeAPIRequest('/api/v1/aag/skim', {
                        ...testDocument,
                        document_id: `${testDocument.document_id}_${i}`
                    }, 'POST')
                );
            }

            await Promise.all(concurrentTests);
            alert('æ€§èƒ½æµ‹è¯•å®Œæˆï¼æŸ¥çœ‹æŒ‡æ ‡é¢æ¿äº†è§£è¯¦æƒ…ã€‚');
        }

        // é”™è¯¯å¤„ç†æµ‹è¯•
        async function testErrorHandling() {
            const errorTestsDiv = document.getElementById('error-test-results');
            errorTestsDiv.innerHTML = '<h4>é”™è¯¯å¤„ç†æµ‹è¯•ç»“æœ:</h4>';

            // æµ‹è¯•æ— æ•ˆæ•°æ®
            const invalidRequest = await makeAPIRequest('/api/v1/aag/skim', { invalid: 'data' }, 'POST');
            errorTestsDiv.innerHTML += `<p>æ— æ•ˆæ•°æ®æµ‹è¯•: ${invalidRequest.success ? 'âŒ åº”è¯¥å¤±è´¥' : 'âœ… æ­£ç¡®å¤„ç†'}</p>`;

            // æµ‹è¯•ä¸å­˜åœ¨çš„ç«¯ç‚¹
            const notFoundRequest = await makeAPIRequest('/api/v1/aag/nonexistent');
            errorTestsDiv.innerHTML += `<p>ä¸å­˜åœ¨ç«¯ç‚¹æµ‹è¯•: ${notFoundRequest.error?.includes('404') ? 'âœ… æ­£ç¡®è¿”å›404' : 'âŒ é”™è¯¯å¤„ç†å¼‚å¸¸'}</p>`;

            // æµ‹è¯•ç©ºè¯·æ±‚
            const emptyRequest = await makeAPIRequest('/api/v1/aag/skim', {}, 'POST');
            errorTestsDiv.innerHTML += `<p>ç©ºè¯·æ±‚æµ‹è¯•: ${emptyRequest.success ? 'âŒ åº”è¯¥å¤±è´¥' : 'âœ… æ­£ç¡®å¤„ç†'}</p>`;
        }

        async function testInvalidRequests() {
            // æµ‹è¯•å„ç§æ— æ•ˆè¯·æ±‚åœºæ™¯
            const tests = [
                { name: 'ç¼ºå°‘å¿…éœ€å­—æ®µ', data: { document_content: 'test' } },
                { name: 'ç©ºæ–‡æ¡£å†…å®¹', data: { document_id: 'test', document_content: '' } },
                { name: 'æ ¼å¼é”™è¯¯çš„JSON', endpoint: '/api/v1/aag/skim', raw: 'invalid json' }
            ];

            const errorTestsDiv = document.getElementById('error-test-results');
            errorTestsDiv.innerHTML += '<h4>æ— æ•ˆè¯·æ±‚æµ‹è¯•:</h4>';

            for (const test of tests) {
                if (test.raw) {
                    // ç‰¹æ®Šå¤„ç†åŸå§‹æ•°æ®
                    try {
                        const response = await fetch(`${API_BASE_URL}${test.endpoint}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: test.raw
                        });
                        errorTestsDiv.innerHTML += `<p>${test.name}: ${response.ok ? 'âŒ åº”è¯¥å¤±è´¥' : 'âœ… æ­£ç¡®å¤„ç†'}</p>`;
                    } catch (error) {
                        errorTestsDiv.innerHTML += `<p>${test.name}: âœ… æ­£ç¡®å¤„ç†å¼‚å¸¸</p>`;
                    }
                } else {
                    const result = await makeAPIRequest('/api/v1/aag/skim', test.data, 'POST');
                    errorTestsDiv.innerHTML += `<p>${test.name}: ${result.success ? 'âŒ åº”è¯¥å¤±è´¥' : 'âœ… æ­£ç¡®å¤„ç†'}</p>`;
                }
            }
        }

        // æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
        function updateMetrics() {
            document.getElementById('total-requests').textContent = metrics.totalRequests;
            document.getElementById('successful-requests').textContent = metrics.successfulRequests;
            
            if (metrics.responseTimes.length > 0) {
                const avgTime = Math.round(metrics.responseTimes.reduce((a, b) => a + b, 0) / metrics.responseTimes.length);
                document.getElementById('avg-response-time').textContent = `${avgTime}ms`;
            }
            
            const errorRate = metrics.totalRequests > 0 ? Math.round((metrics.errors / metrics.totalRequests) * 100) : 0;
            document.getElementById('error-rate').textContent = `${errorRate}%`;
        }

        function resetMetrics() {
            metrics = {
                totalRequests: 0,
                successfulRequests: 0,
                responseTimes: [],
                errors: 0
            };
            updateMetrics();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹æœåŠ¡
        window.onload = function() {
            checkServices();
        };
    </script>
</body>
</html>