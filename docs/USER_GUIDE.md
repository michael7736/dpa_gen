# DPA Next 用户使用指南

## 目录

1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [核心功能](#核心功能)
4. [项目管理](#项目管理)
5. [文档处理](#文档处理)
6. [认知分析](#认知分析)
7. [任务管理](#任务管理)
8. [记忆系统](#记忆系统)
9. [最佳实践](#最佳实践)
10. [常见问题](#常见问题)

## 系统简介

DPA Next（Document Processing Agent）是一个基于AI的智能知识引擎，专门设计用于处理大量文档、构建知识图谱并提供深度洞察。

### 主要特性

- 🚀 **项目生命周期管理**：从需求到交付的完整工作流
- 📄 **智能文档处理**：支持多种格式，自动提取关键信息
- 🧠 **认知分析**：深度理解文档内容，生成洞察
- 💬 **智能对话**：基于项目上下文的问答系统
- 🔄 **三层记忆系统**：工作记忆、任务记忆、项目记忆
- 📊 **可视化报告**：自动生成项目报告和分析结果

## 快速开始

### 1. 系统要求

- Python 3.11+
- 8GB+ RAM（推荐16GB）
- 10GB+ 可用磁盘空间
- 稳定的网络连接

### 2. 安装和启动

```bash
# 克隆项目
git clone https://github.com/your-org/dpa-next.git
cd dpa-next

# 创建conda环境
conda env create -f environment.yml
conda activate dpa_gen

# 配置环境
cp env.template .env
# 编辑.env文件，填入必要的配置

# 启动服务
./start-all.sh
```

服务启动后，访问：
- Web界面：http://localhost:3000
- API文档：http://localhost:8001/docs

### 3. 首次登录

1. 打开浏览器访问 http://localhost:3000
2. 点击"注册"创建新账号
3. 使用邮箱和密码登录
4. 完成初始设置向导

## 核心功能

### 项目类型

DPA支持多种项目类型，每种类型都有优化的工作流：

1. **研究项目** (research)
   - 适用于学术研究、市场调研
   - 强调文献收集和深度分析
   
2. **分析项目** (analysis)
   - 适用于数据分析、业务分析
   - 注重数据处理和洞察发现

3. **报告项目** (report)
   - 适用于定期报告、总结报告
   - 自动化报告生成

4. **文档项目** (documentation)
   - 适用于技术文档、知识库
   - 结构化文档管理

5. **自定义项目** (custom)
   - 灵活配置的项目类型
   - 可自定义工作流

## 项目管理

### 创建新项目

1. **通过Web界面**
   - 点击"新建项目"按钮
   - 填写项目信息：
     - 项目名称（必填）
     - 项目描述
     - 项目类型
     - 目标和约束
   - 点击"创建"

2. **通过API**
   ```python
   import requests
   
   project_data = {
       "name": "AI技术研究",
       "description": "研究最新AI技术趋势",
       "type": "research",
       "objectives": ["了解GPT-4", "分析应用案例"],
       "constraints": ["2周内完成", "使用公开资源"]
   }
   
   response = requests.post(
       "http://localhost:8001/api/v1/projects",
       json=project_data,
       headers={"Authorization": f"Bearer {token}"}
   )
   ```

### 项目生命周期

项目会经历以下阶段：

1. **草稿 (draft)**
   - 项目刚创建，可以修改所有信息
   - 添加初始文档和设置

2. **规划 (planning)**
   - 系统自动分析需求
   - 生成任务列表
   - 可以调整任务顺序和依赖

3. **执行 (executing)**
   - 任务按顺序自动执行
   - 实时查看进度
   - 可以暂停和恢复

4. **完成 (completed)**
   - 所有任务执行完毕
   - 生成最终报告
   - 可以导出结果

### 项目配置

每个项目都可以自定义配置：

```json
{
  "max_tasks": 20,           // 最大任务数
  "auto_execute": true,      // 是否自动执行
  "parallel_tasks": 3,       // 并行任务数
  "quality_threshold": 0.8,  // 质量阈值
  "language": "zh-CN"        // 输出语言
}
```

## 文档处理

### 支持的文件格式

- 📄 PDF文档
- 📝 Word文档 (.docx)
- 📃 文本文件 (.txt, .md)
- 📊 结构化数据 (.json, .csv)
- 🖼️ 图片（带OCR）

### 上传文档

1. **单个文档上传**
   - 在项目页面点击"上传文档"
   - 选择文件（最大50MB）
   - 添加标题和标签
   - 点击"上传"

2. **批量上传**
   - 支持拖拽多个文件
   - 自动识别文件类型
   - 批量添加标签

3. **文件夹上传**
   ```python
   # 使用Python脚本批量上传
   import os
   from pathlib import Path
   
   folder_path = Path("./research_papers")
   for file_path in folder_path.glob("*.pdf"):
       upload_document(project_id, file_path)
   ```

### 文档处理流程

1. **解析**：提取文本、元数据、结构
2. **分块**：智能分割成语义完整的片段
3. **向量化**：生成嵌入向量用于检索
4. **实体提取**：识别人名、地点、概念等
5. **关系构建**：建立知识图谱连接

## 认知分析

### 文档分析

DPA提供三种分析模式：

1. **快速分析** (quick)
   - 5分钟内完成
   - 提取关键信息
   - 生成摘要

2. **深度分析** (deep)
   - 15-30分钟
   - 全面理解内容
   - 识别主题和模式
   - 生成详细洞察

3. **对比分析** (comparative)
   - 比较多个文档
   - 找出共同点和差异
   - 生成对比报告

### 使用认知对话

认知对话功能让您可以与项目知识库进行智能交互：

1. **基础问答**
   ```
   用户：这个项目的主要发现是什么？
   系统：根据分析，主要发现包括...
   ```

2. **深度探讨**
   ```
   用户：请详细解释第三个发现的理论基础
   系统：第三个发现基于以下理论...
   ```

3. **创意激发**
   ```
   用户：基于这些发现，有什么创新应用的可能？
   系统：我建议考虑以下创新方向...
   ```

### 分析策略

系统会根据问题类型自动选择策略：

- **语义搜索**：查找相关内容
- **推理分析**：逻辑推导答案
- **综合生成**：整合多源信息
- **创意思考**：提供新视角

## 任务管理

### 任务类型

1. **数据收集** (data_collection)
   - 搜集相关文档
   - 爬取网络资源
   - 整理现有资料

2. **数据索引** (data_indexing)
   - 建立检索索引
   - 优化查询性能
   - 更新元数据

3. **深度分析** (deep_analysis)
   - 执行认知分析
   - 生成洞察报告
   - 识别关键模式

4. **验证** (verification)
   - 检查数据质量
   - 验证分析结果
   - 交叉引用确认

5. **报告撰写** (report_writing)
   - 自动生成报告
   - 格式化输出
   - 添加可视化

### 任务依赖管理

任务可以设置依赖关系：

```python
task_a = create_task("收集文献", type="data_collection")
task_b = create_task("分析文献", type="deep_analysis", 
                     dependencies=[task_a.id])
task_c = create_task("撰写报告", type="report_writing",
                     dependencies=[task_b.id])
```

### 任务优先级

- 0-2：低优先级（可延后）
- 3-5：正常优先级
- 6-8：高优先级
- 9-10：紧急任务

## 记忆系统

### 三层记忆架构

1. **工作记忆** (Working Memory)
   - 当前会话的临时信息
   - 1小时后自动清理
   - 用于保持对话连贯性

2. **任务记忆** (Task Memory)
   - 任务执行的中间结果
   - 24小时保留
   - 支持任务恢复和回溯

3. **项目记忆** (Project Memory)
   - 项目级的长期知识
   - 永久保存
   - 包含关键发现和决策

### 记忆管理

```python
# 保存项目记忆
save_memory(
    project_id=project_id,
    memory_type="project",
    content={
        "key_findings": ["发现1", "发现2"],
        "decisions": ["决策1", "决策2"],
        "insights": ["洞察1", "洞察2"]
    }
)

# 查询记忆
memories = get_memories(
    project_id=project_id,
    memory_type="project",
    query="关键发现"
)
```

## 最佳实践

### 1. 项目规划

- **明确目标**：在创建项目时清晰定义目标
- **合理约束**：设置现实的时间和资源约束
- **分阶段执行**：大项目分解为多个小项目

### 2. 文档管理

- **统一命名**：使用一致的文件命名规范
- **添加标签**：为文档添加描述性标签
- **定期整理**：删除重复和过时文档

### 3. 任务设计

- **原子任务**：每个任务只做一件事
- **明确依赖**：正确设置任务依赖关系
- **合理估时**：为任务设置现实的时间估计

### 4. 质量控制

- **设置阈值**：定义质量标准
- **人工审核**：关键结果需要人工确认
- **迭代改进**：根据反馈优化流程

### 5. 性能优化

- **批量操作**：尽量使用批量上传和处理
- **并行执行**：利用并行任务提高效率
- **缓存利用**：重复查询会自动缓存

## 常见问题

### Q1: 项目执行失败怎么办？

**A**: 检查以下几点：
1. 查看错误日志了解具体原因
2. 确认所有依赖任务已完成
3. 检查文档是否正确上传
4. 验证API密钥是否有效
5. 尝试降低并行任务数

### Q2: 如何提高分析质量？

**A**: 
1. 上传高质量的源文档
2. 使用深度分析模式
3. 提供更多上下文信息
4. 设置合适的质量阈值
5. 进行多轮迭代分析

### Q3: 支持中文文档吗？

**A**: 完全支持！系统对中文有优化：
- 中文分词和实体识别
- 中文专用的嵌入模型
- 中文知识图谱构建
- 中英双语报告生成

### Q4: 如何导出项目结果？

**A**: 多种导出方式：
1. PDF报告：完整的项目报告
2. JSON数据：结构化数据导出
3. 知识图谱：Neo4j格式导出
4. Markdown文档：便于编辑
5. Excel表格：数据分析结果

### Q5: 系统安全性如何？

**A**: 多层安全保障：
- JWT令牌认证
- 项目级权限控制
- 数据加密存储
- 审计日志记录
- 定期安全更新

### Q6: 可以自定义工作流吗？

**A**: 是的，通过自定义项目类型：
1. 定义任务模板
2. 设置执行顺序
3. 配置质量标准
4. 添加自定义脚本
5. 集成外部工具

### Q7: 如何监控项目进度？

**A**: 多种监控方式：
- Web界面实时进度条
- WebSocket推送更新
- API轮询状态
- 邮件通知（可选）
- 日志文件查看

### Q8: 支持团队协作吗？

**A**: 基础协作功能：
- 项目共享（开发中）
- 评论和批注（计划中）
- 版本控制（计划中）
- 任务分配（计划中）

## 故障排除

### 服务无法启动

```bash
# 检查端口占用
lsof -i :8001
lsof -i :3000

# 查看日志
tail -f data/logs/app.log
tail -f data/logs/error.log

# 重置服务
./scripts/reset_services.sh
```

### 文档上传失败

1. 检查文件大小（<50MB）
2. 确认文件格式支持
3. 验证网络连接
4. 查看API响应错误

### 分析结果不理想

1. 提高文档质量
2. 增加相关文档数量
3. 调整分析参数
4. 使用更合适的模型

## 获取帮助

- 📧 邮件支持：support@dpa.ai
- 💬 社区论坛：https://forum.dpa.ai
- 📚 开发文档：https://docs.dpa.ai
- 🐛 问题反馈：https://github.com/dpa/issues

---

感谢使用DPA Next！我们持续改进产品，您的反馈对我们非常重要。